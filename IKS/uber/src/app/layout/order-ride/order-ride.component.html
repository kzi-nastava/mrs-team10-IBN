<app-nav-bar></app-nav-bar>
<div class="container">
  <div class="left-panel">
    <div class="header">
      <h1>Choose a ride</h1>
      <button (click)="openFavorites()">Favorites</button>
    </div>
    @if (!isDropdownOpen) {
    <div class="location-input" (click)="toggleDropdown()">
      <div class="location-text">{{ locationText }}</div>
      <div class="time-selector">âŒ› {{ timeText }}</div>
      <span class="dropdown-arrow" [class.rotated]="isDropdownOpen">â–¼</span>
    </div>
    } @if (isDropdownOpen) {
    <div class="dropdown-content">
      <div class="input-group">
        <label>From:</label>
        <input type="text" placeholder="Enter pickup location" [(ngModel)]="fromLocation" />
      </div>

      <div class="input-group">
        <label>To:</label>
        <input type="text" placeholder="Enter destination" [(ngModel)]="toLocation" />
      </div>

      <button class="add-stop-btn" (click)="addStop()">+ Add stop</button>

      @for(stop of stops; track $index; let i = $index) {
      <div class="input-group">
        <label>Stop {{ i + 1 }}:</label>
        <div style="display: flex; gap: 5px">
          <input type="text" placeholder="Enter stop location" [(ngModel)]="stops[i]" />
          <button class="remove-stop-btn" (click)="removeStop(i)">x</button>
        </div>
      </div>
      }

      <div class="time-selection">
        <label>When:</label>
        <div class="time-options">
          <label class="radio-option">
            <input type="radio" name="time" value="now" [(ngModel)]="timeOption" />
            <span>Leave now</span>
          </label>
          <label class="radio-option">
            <input type="radio" name="time" value="schedule" [(ngModel)]="timeOption" />
            <span>Schedule for later</span>
          </label>
        </div>
      </div>

      @if(timeOption === 'schedule') {
      <div class="datetime-picker">
        <input type="date" [(ngModel)]="rideDate" />
        <input type="time" [(ngModel)]="rideTime" />
      </div>
      }

      <button class="confirm-btn" (click)="confirmSelection()">Confirm</button>
    </div>
    }

    <div class="car-options">
      <div
        class="car-option"
        [class.selected]="selectedCar === 'STANDARD'"
        (click)="selectCar('STANDARD')"
      >
        <img src="standard.png" alt="Standard" />
        <div class="car-name">Standard</div>
      </div>

      <div
        class="car-option"
        [class.selected]="selectedCar === 'LUXURY'"
        (click)="selectCar('LUXURY')"
      >
        <img src="luxury.png" alt="Luxury" />
        <div class="car-name">Luxury</div>
      </div>

      <div class="car-option" [class.selected]="selectedCar === 'VAN'" (click)="selectCar('VAN')">
        <img src="van.png" alt="Van" />
        <div class="car-name">Van</div>
      </div>
    </div>

    @if (!isShareRideOpen) {
    <div class="share-ride" (click)="toggleShareRide()">
      <span class="share-icon">ðŸ‘¥</span>
      @if (passengerEmails.length > 0) {
      <span
        >Share a ride ({{ passengerEmails.length }} passenger{{
          passengerEmails.length > 1 ? 's' : ''
        }})</span
      >
      } @else {
      <span>Share a ride</span>
      }
      <span
        class="dropdown-arrow2"
        [class.rotated]="isShareRideOpen"
        style="margin-left: auto; font-size: 12px"
        >â–¼</span
      >
    </div>
    } @if (isShareRideOpen) {
    <div class="dropdown-content">
      <div class="input-group">
        <label>Add passengers by email:</label>
      </div>

      @for(email of passengerEmails; track $index; let i = $index) {
      <div class="input-group">
        <label style="margin: 5px 0">Passenger {{ i + 1 }}:</label>
        <div style="display: flex; gap: 5px">
          <input
            type="email"
            placeholder="Enter passenger email"
            [(ngModel)]="passengerEmails[i]"
            [id]="'passenger-' + i"
            [name]="'passenger-' + i"
          />
          <button class="remove-stop-btn" (click)="removePassenger(i)">x</button>
        </div>
      </div>
      }

      <button class="add-stop-btn" (click)="addPassenger()" style="margin-top: 5px">
        + Add passenger
      </button>

      <button class="confirm-btn" (click)="confirmShareRide()">Confirm</button>
    </div>
    }

    <div class="checkbox-group">
      <div class="checkbox-item">
        <input type="checkbox" id="baby" />
        <label for="baby">Are you travelling with a baby?</label>
      </div>
      <div class="checkbox-item">
        <input type="checkbox" id="pet" />
        <label for="pet">Are you travelling with a pet?</label>
      </div>
    </div>

    <div class="bottom">
      <div class="total-price">Total Price: {{ totalPrice ?? ' -' }}</div>

      @if (totalPrice !== null) {
      <button class="order-btn">Order</button>
      }
    </div>
  </div>
  <app-map
    [locations]="getLocations()"
    (locationAdded)="onLocationAdded($event)"
    (locationRemoved)="onLocationRemoved($event)"
    (routeCalculated)="onRouteCalculated($event)"
    [isUserLoggedIn]="true"
  >
  </app-map>
</div>
@if(showFavoritesPopup) {
<app-favorites-popup (routeSelected)="onRouteSelected($event)" (closed)="closeFavorites()">
</app-favorites-popup>
} @if (successMessage) {
<div class="message success-message">
  {{ successMessage }}
</div>
} @if (errorMessage) {
<div class="message error-message">
  {{ errorMessage }}
</div>
}

<router-outlet></router-outlet>
