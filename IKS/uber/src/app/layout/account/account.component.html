<app-nav-bar></app-nav-bar>

<canvas id="particles-canvas"></canvas>

<div class="container">
  <h1>My Account</h1>

  <div class="account-wrapper">
    <div class="card profile-card">
      <div class="profile-pic">
        <img [src]="userProfileImage" alt="Profile Picture" />
      </div>

      <h2>{{ driverFormData.firstName }} {{ driverFormData.lastName }}</h2>

      <ul class="menu">
        @for (item of menuItems; track item.label) {
        <li
          (click)="item.label === 'My vehicle' ? openVehicleModal() : null"
          [routerLink]="item.label !== 'My vehicle' ? item.route : null"
        >
          <span class="icon">{{ item.icon }}</span>
          {{ item.label }}
        </li>
        }
      </ul>
    </div>

    @if (userRole === 'driver') {
    <div class="work-hours-section">
      <div class="semicircle-progress">
        <svg viewBox="0 0 200 120" class="progress-svg">
          <path
            d="M 20 100 A 80 80 0 0 1 180 100"
            fill="none"
            stroke="rgba(255, 255, 255, 0.1)"
            stroke-width="20"
            stroke-linecap="round"
          />
          <path
            d="M 20 100 A 80 80 0 0 1 180 100"
            fill="none"
            [attr.stroke]="getProgressPercentage() > 80 ? '#4caf50' : '#ff9800'"
            stroke-width="20"
            stroke-linecap="round"
            class="progress-arc"
            [style.stroke-dasharray]="251.2"
            [style.stroke-dashoffset]="251.2 - (251.2 * getProgressPercentage()) / 100"
          />
        </svg>
        <div class="progress-text">
          <div class="hours-big">{{ hoursWorkedToday }}</div>
          <div class="hours-small">out of {{ maxHoursPerDay }}h</div>
        </div>
      </div>
    </div>
    }

    <app-driver-form
      [formData]="driverFormData"
      [originalData]="originalDriverData"
      [buttonLabel]="userRole === 'driver' ? 'Send changes' : 'Save changes'"
      [emailReadonly]="true"
      [showProfilePicture]="false"
      [userProfileImage]="userProfileImage"
      (formSubmit)="onDriverFormSubmit($event)"
      (profileImageChange)="onProfileImageChange($event)"
    ></app-driver-form>
  </div>

  @if (successMessage) {
  <div class="success">
    {{ successMessage }}
  </div>
  } @if (showVehicleModal) {
  <app-vehicle-form
    [vehicleData]="vehicleData"
    [buttonLabel]="'Send Changes'"
    [showAsModal]="true"
    (formSubmit)="onVehicleFormSubmit($event)"
    (closeModal)="closeVehicleModal()"
  ></app-vehicle-form>
  }
</div>

<router-outlet></router-outlet>
